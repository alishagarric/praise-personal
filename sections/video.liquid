{{ 'video-section.css' | asset_url | stylesheet_tag }}
{{ 'deferred-media.css' | asset_url | stylesheet_tag }}

{% style %}
  #Video-section-{{ section.id }} {
    --topSpacingRatio: {{section.settings.top_spacing}} / 100;
    --bottomSpacingRatio: {{section.settings.bottom_spacing}} / 100;
  }
{% endstyle %}

<script src="{{ 'video-section.js' | asset_url }}" defer></script>

{% if section.settings.video_url != blank %}
  {% capture cover %}
    {% if section.settings.cover_image %}
      {% render 'next-gen-img' image: section.settings.cover_image, width: 3360, widths: "3360, 2100, 1700, 1400, 1100, 700", sizes: "100vw" %}
    {% else %}
      {{ 'collection-2' | placeholder_svg_tag: 'placeholder' }}
    {% endif %}
  {% endcapture %}

  <div
    id="Video-section-{{ section.id }}"
    class="video-section __theme-{{ section.settings.theme }} {% if section.settings.fullwidth %}__fullwidth{% endif %}"
  >
    {% if section.settings.text or section.settings.heading %}
      <div 
        class="video-section__text-container __align-center {% if section.settings.overlay_theme %}__theme-{{ section.settings.overlay_theme }}{% endif %}"
        style="--textPlacement: {{ section.settings.text_placement }};"
      >
        {% render 'heading',
          class: 'collections-list',
          heading: section.settings.heading,
          alt_heading: section.settings.alt_heading,
          heading_size: section.settings.heading_size
        %}

        {% if section.settings.text %}
          <div
            class="video-section__rich-text __article-txt-{{ section.settings.text_size }}"
          >
            {{ section.settings.text }}
          </div>
        {% endif %}
      </div>
    {% endif %}

    <noscript>
      <div
        class="video-section__media {% if section.settings.overlay_theme %}__theme-{{ section.settings.overlay_theme }}{% endif %}"
        style="--overlayOpacity: calc({{ section.settings.overlay }} / 100);"
      >
        <a
          href="{{ section.settings.video_url }}"
          class="video-section__poster {% if section.settings.cover_image == blank %} maybe-some-class-that-handles-svg {% endif %}"
        >
          {{ cover }}
        </a>
      </div>
    </noscript>

    <deferred-media
      class="video-section__media-background deferred-media no-js-hidden image-container __crop-{{ section.settings.crop_shape }} {% if section.settings.overlay_theme %}__theme-{{ section.settings.overlay_theme }}{% endif %}"
      data-media-id="{{ section.settings.video_url.id }}"
    >

    {%- if section.settings.video_url.type == 'youtube' -%}
      <video-section
        data-init-mode="background"
        data-parent="deferred-media"
        data-type="youtube"
        data-video-id="{{ section.settings.video_url.id }}"
      >
      </video-section>
      {%- else -%}
        <video-section
          data-init-mode="background"
          data-parent="deferred-media"
          data-type="vimeo"
          data-video-id="{{ section.settings.video_url.id }}"
        ></video-section>
      {%- endif -%}
    </deferred-media>

    <deferred-media
      class="video-section__media deferred-media no-js-hidden image-container __crop-{{ section.settings.crop_shape }} {% if section.settings.overlay_theme %}__theme-{{ section.settings.overlay_theme }}{% endif %}"
      data-media-id="{{ section.settings.video_url.id }}"
    >
      {% comment %} Image image/button {% endcomment %}
      <button
        id="Deferred-Poster-{{ section.settings.video_url.id }}"
        type="button"
        class="video-section__poster deferred-media__poster"
      >
        {{ cover }}
      </button>

      {% comment %} Video to be loaded {% endcomment %}
      <template>
        {%- if section.settings.video_url.type == 'youtube' -%}
          <video-section
            data-init-mode="template"
            data-parent="deferred-media"
            data-type="youtube"
            data-video-id="{{ section.settings.video_url.id }}"
          >
          </video-section>
        {%- else -%}
          <video-section
            data-init-mode="template"
            data-parent="deferred-media"
            data-type="vimeo"
            data-video-id="{{ section.settings.video_url.id }}"
          ></video-section>
        {%- endif -%}
      </template>
    </deferred-media>
  </div>
{% endif %}

{% schema %}
{
  "name": "t:sections.video.name",
  "tag": "section",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.video.settings.header.content"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:sections.video.settings.heading.label",
      "default": "Video Section"
    },
    {
      "type": "select",
      "id": "heading_size",
      "options": [
        {
          "value": "h2",
          "label": "t:sections.video.settings.heading_size.options.label_1"
        },
        {
          "value": "h4",
          "label": "t:sections.video.settings.heading_size.options.label_2"
        },
        {
          "value": "h5",
          "label": "t:sections.video.settings.heading_size.options.label_3"
        },
        {
          "value": "h6",
          "label": "t:sections.video.settings.heading_size.options.label_4"
        }
      ],
      "default": "h4",
      "label": "t:sections.video.settings.heading_size.label"
    },
    {
      "type": "checkbox",
      "id": "alt_heading",
      "label": "t:sections.video.settings.alt_heading.label"
    },
    {
      "type": "richtext",
      "id": "text",
      "default": "<p>Add some text that introduces the video they will watch</p>",
      "label": "t:sections.video.settings.text.label"
    },
    {
      "type": "select",
      "id": "text_size",
      "options": [
        {
          "value": "p-sm",
          "label": "t:sections.video.settings.description_text_size.options.label_1"
        },
        {
          "value": "p",
          "label": "t:sections.video.settings.description_text_size.options.label_2"
        },
        {
          "value": "p-lg",
          "label": "t:sections.video.settings.description_text_size.options.label_3"
        }
      ],
      "default": "p-sm",
      "label": "t:sections.video.settings.description_text_size.label"
    },
    {
      "type": "select",
      "id": "text_placement",
      "default": "start",
      "label": "t:sections.video.settings.text_placement.label",
      "options": [
        {
          "value": "start",
          "label": "t:sections.video.settings.text_placement.options.label_1"
        },
        {
          "value": "end",
          "label": "t:sections.video.settings.text_placement.options.label_2"
        },
        {
          "value": "center",
          "label": "t:sections.video.settings.text_placement.options.label_3"
        },
        {
          "value": "space-between",
          "label": "t:sections.video.settings.text_placement.options.label_4"
        }
      ]
    },
    {
      "type": "header",
      "content": "t:sections.video.settings.header_3.content"
    },
    {
      "type": "image_picker",
      "id": "cover_image",
      "label": "t:sections.video.settings.cover_image.label"
    },
    {
      "type": "video_url",
      "id": "video_url",
      "label": "t:sections.video.settings.video_url.label",
      "accept": ["youtube", "vimeo"]
    },
    {
      "type": "range",
      "id": "overlay",
      "label": "t:sections.video_url.settings.overlay.label",
      "info": "t:sections.video_url.settings.overlay.info",
      "min": 0,
      "max": 70,
      "step": 10,
      "unit": "%",
      "default": 0
    },
    {
      "type": "select",
      "id": "overlay_theme",
      "options": [
        {
          "value": "primary",
          "label": "t:sections.video_url.settings.overlay_theme.options.label_1"
        },
        {
          "value": "2",
          "label": "t:sections.video_url.settings.overlay_theme.options.label_2"
        },
        {
          "value": "3",
          "label": "t:sections.video_url.settings.overlay_theme.options.label_3"
        },
        {
          "value": "4",
          "label": "t:sections.video_url.settings.overlay_theme.options.label_4"
        },
        {
          "value": "5",
          "label": "t:sections.video_url.settings.overlay_theme.options.label_5"
        }
      ],
      "default": "primary",
      "label": "t:sections.video_url.settings.overlay_theme.label"
    },
    {
      "type": "select",
      "id": "crop_shape",
      "options": [
        {
          "value": "video",
          "label": "t:sections.video.settings.crop_shape.options.label_1"
        },
        {
          "value": "square",
          "label": "t:sections.video.settings.crop_shape.options.label_2"
        },
        {
          "value": "landscape",
          "label": "t:sections.video.settings.crop_shape.options.label_3"
        },
        {
          "value": "wide",
          "label": "t:sections.video.settings.crop_shape.options.label_4"
        },
        {
          "value": "dome",
          "label": "t:sections.video.settings.crop_shape.options.label_5"
        }
      ],
      "default": "wide",
      "label": "t:sections.video.settings.crop_shape.label"
    },
    {
      "type": "checkbox",
      "label": "t:sections.video.settings.fullwidth.label",
      "id": "fullwidth",
      "default": false
    },
    {
      "type": "header",
      "content": "t:sections.video.settings.header_4.content"
    },
    {
      "type": "select",
      "id": "theme",
      "options": [
        {
          "value": "primary",
          "label": "t:sections.video.settings.options.label1"
        },
        {
          "value": "2",
          "label": "t:sections.video.settings.options.label2"
        },
        {
          "value": "3",
          "label": "t:sections.video.settings.options.label3"
        },
        {
          "value": "4",
          "label": "t:sections.video.settings.options.label4"
        },
        {
          "value": "5",
          "label": "t:sections.video.settings.options.label5"
        }
      ],
      "default": "primary",
      "label": "t:sections.video.settings.label"
    },
    {
      "type": "header",
      "content": "t:sections.video.settings.header_3.content"
    },
    {
      "type": "range",
      "id": "top_spacing",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "%",
      "label": "t:sections.video.settings.range1.label",
      "default": 50
    },
    {
      "type": "range",
      "id": "bottom_spacing",
      "min": 0,
      "max": 100,
      "step": 10,
      "unit": "%",
      "label": "t:sections.video.settings.range2.label",
      "default": 50
    }
  ],
  "blocks": [],
  "presets": [
    {
      "name": "t:sections.video.presets.name"
    }
  ]
}
{% endschema %}
